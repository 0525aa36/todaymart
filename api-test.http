### 한국 농산물 쇼핑몰 API 테스트
### Base URL
@baseUrl = http://localhost:8081
@adminEmail = test@test.com
@adminPassword = password123

### ============================================
### 1. 인증 (Authentication)
### ============================================

### 1.1 로그인 (관리자)
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### 로그인 응답에서 토큰 추출
@token = {{login.response.body.token}}

### 1.2 로그인 (일반 사용자)
# @name userLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password"
}

### ============================================
### 2. 상품 (Products) - 공개 API
### ============================================

### 2.1 전체 상품 목록 조회
GET {{baseUrl}}/api/products?page=0&size=10

### 2.2 특정 상품 상세 조회
GET {{baseUrl}}/api/products/63

### 2.3 상품 검색
GET {{baseUrl}}/api/products/search?keyword=밤

### 2.4 카테고리별 상품 조회
GET {{baseUrl}}/api/products?category=농수산물

### 2.5 상품 옵션 조회 (공개)
GET {{baseUrl}}/api/products/63/options/public

### ============================================
### 3. 장바구니 (Cart) - 인증 필요
### ============================================

### 3.1 내 장바구니 조회
GET {{baseUrl}}/api/cart
Authorization: Bearer {{token}}

### 3.2 장바구니에 상품 추가
POST {{baseUrl}}/api/cart/items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "productId": 63,
  "productOptionId": null,
  "quantity": 2
}

### 3.3 장바구니 아이템 수량 변경
PUT {{baseUrl}}/api/cart/items/34
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "quantity": 5
}

### 3.4 장바구니 아이템 삭제
DELETE {{baseUrl}}/api/cart/items/34
Authorization: Bearer {{token}}

### 3.5 장바구니 전체 비우기
DELETE {{baseUrl}}/api/cart/clear
Authorization: Bearer {{token}}

### ============================================
### 4. 주문 (Orders) - 인증 필요
### ============================================

### 4.1 주문 생성
# @name createOrder
POST {{baseUrl}}/api/orders
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "items": [
    {
      "productId": 63,
      "productOptionId": null,
      "quantity": 2
    }
  ],
  "recipientName": "홍길동",
  "recipientPhone": "010-1234-5678",
  "shippingAddressLine1": "서울시 강남구 테헤란로 123",
  "shippingAddressLine2": "오피스빌딩 5층",
  "shippingPostcode": "06234",
  "senderName": "김발송",
  "senderPhone": "010-9876-5432",
  "deliveryMessage": "문 앞에 놓아주세요"
}

@orderId = {{createOrder.response.body.id}}

### 4.2 내 주문 목록 조회
GET {{baseUrl}}/api/orders
Authorization: Bearer {{token}}

### 4.3 특정 주문 상세 조회
GET {{baseUrl}}/api/orders/{{orderId}}
Authorization: Bearer {{token}}

### 4.4 주문 취소
POST {{baseUrl}}/api/orders/{{orderId}}/cancel
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "cancellationReason": "단순 변심"
}

### ============================================
### 5. 관리자 API (Admin) - ADMIN 권한 필요
### ============================================

### 5.1 대시보드 통계
GET {{baseUrl}}/api/admin/dashboard/stats
Authorization: Bearer {{token}}

### 5.2 전체 주문 조회 (페이징)
GET {{baseUrl}}/api/admin/orders?page=0&size=20
Authorization: Bearer {{token}}

### 5.3 주문 상태별 필터링
GET {{baseUrl}}/api/admin/orders?orderStatus=PENDING&page=0&size=20
Authorization: Bearer {{token}}

### 5.4 주문 상태 변경
PUT {{baseUrl}}/api/admin/orders/{{orderId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "PAID"
}

### 5.5 송장 번호 등록
PUT {{baseUrl}}/api/admin/orders/{{orderId}}/tracking
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "trackingNumber": "1234567890"
}

### 5.6 전체 상품 조회 (관리자용)
GET {{baseUrl}}/api/admin/products?page=0&size=20
Authorization: Bearer {{token}}

### 5.7 상품 생성
POST {{baseUrl}}/api/admin/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "테스트 상품",
  "category": "농수산물",
  "origin": "국내산",
  "description": "테스트용 상품입니다",
  "price": 10000,
  "stock": 100,
  "imageUrl": "http://localhost:8081/api/files/test.jpg"
}

### 5.8 상품 옵션 추가
POST {{baseUrl}}/api/products/63/options
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "optionName": "중량",
  "optionValue": "1kg",
  "additionalPrice": 0,
  "stock": 50,
  "isAvailable": true
}

### 5.9 크롤러 상태 확인
GET {{baseUrl}}/api/admin/crawler/status
Authorization: Bearer {{token}}

### 5.10 크롤러 실행
POST {{baseUrl}}/api/admin/crawler/run
Authorization: Bearer {{token}}

### ============================================
### 6. 리뷰 (Reviews) - 일부 인증 필요
### ============================================

### 6.1 상품의 리뷰 목록 조회 (공개)
GET {{baseUrl}}/api/reviews/product/63?page=0&size=10

### 6.2 리뷰 작성 (인증 필요)
POST {{baseUrl}}/api/reviews
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "orderId": {{orderId}},
  "productId": 63,
  "rating": 5,
  "content": "상품이 아주 신선하고 좋았습니다!",
  "images": []
}

### 6.3 내 리뷰 목록 조회
GET {{baseUrl}}/api/reviews/my
Authorization: Bearer {{token}}

### ============================================
### 7. 위시리스트 (Wishlist) - 인증 필요
### ============================================

### 7.1 내 위시리스트 조회
GET {{baseUrl}}/api/wishlist
Authorization: Bearer {{token}}

### 7.2 위시리스트에 추가
POST {{baseUrl}}/api/wishlist/items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "productId": 63
}

### 7.3 위시리스트에서 삭제
DELETE {{baseUrl}}/api/wishlist/items/1
Authorization: Bearer {{token}}

### ============================================
### 8. 사용자 프로필 (User Profile) - 인증 필요
### ============================================

### 8.1 내 프로필 조회
GET {{baseUrl}}/api/users/me
Authorization: Bearer {{token}}

### 8.2 프로필 수정
PUT {{baseUrl}}/api/users/me
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "홍길동",
  "phone": "010-1234-5678",
  "addressLine1": "서울시 강남구",
  "addressLine2": "101호",
  "postcode": "12345"
}

### 8.3 비밀번호 변경
PUT {{baseUrl}}/api/users/me/password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPassword": "{{adminPassword}}",
  "newPassword": "newPassword123"
}

### ============================================
### 9. 파일 업로드
### ============================================

### 9.1 이미지 업로드 (multipart/form-data)
### IntelliJ나 VS Code에서는 파일 선택 UI가 나타납니다
POST {{baseUrl}}/api/files/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="test.jpg"
Content-Type: image/jpeg

< ./test.jpg
------WebKitFormBoundary--

### ============================================
### 10. 결제 (Payments) - 인증 필요
### ============================================

### 10.1 결제 요청
POST {{baseUrl}}/api/payments/{{orderId}}/request
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "paymentMethod": "CARD"
}

### 10.2 결제 확인 (Toss Payments 리다이렉트 후)
POST {{baseUrl}}/api/payments/confirm
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "paymentKey": "test_payment_key",
  "orderId": "ORDER_1234567890",
  "amount": 44000
  
}

### ============================================
### 11. 알림 (Notifications) - 인증 필요
### ============================================

### 11.1 SSE 알림 스트림 연결
### 브라우저나 EventSource로 테스트
GET {{baseUrl}}/api/notifications/stream
Authorization: Bearer {{token}}

### 11.2 읽지 않은 알림 수
GET {{baseUrl}}/api/notifications/unread-count
Authorization: Bearer {{token}}

### 11.3 모든 알림 읽음 처리
PUT {{baseUrl}}/api/notifications/mark-all-read
Authorization: Bearer {{token}}
